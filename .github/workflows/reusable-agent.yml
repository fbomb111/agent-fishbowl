name: Reusable Agent Runner

on:
  workflow_call:
    inputs:
      role:
        description: 'Agent role from config/roles.json (e.g., engineer, reviewer, product-owner)'
        type: string
        required: false
      job:
        description: 'Job for multi-job roles (from agents/prompts/jobs/{role}/). Requires role input.'
        type: string
        required: false
      entry-point:
        description: 'Script to run relative to harness root (e.g., scripts/run-strategic.sh)'
        type: string
        required: false
      timeout:
        description: 'Job timeout in minutes'
        type: number
        default: 30

jobs:
  run:
    name: Run ${{ inputs.role || 'script' }}
    runs-on: self-hosted
    timeout-minutes: ${{ inputs.timeout }}
    concurrency:
      group: agent-${{ inputs.role || 'script' }}
      cancel-in-progress: false
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5  # v4

      # HARNESS PIN â€” must match harness_ref in config/agent-flow.yaml
      # Bump via: scripts/bump-harness.sh <new-version>
      - name: Run agent
        uses: YourMoveLabs/agent-harness@fcb5e86f2cce015c7df88ae190b5030b3522fce1  # v1.6.1
        with:
          role: ${{ inputs.role }}
          job: ${{ inputs.job }}
          entry-point: ${{ inputs.entry-point }}
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
